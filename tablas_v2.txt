CREATE TABLE CLIENTE(
    ID_CLIENTE NUMBER(5)
    CONSTRAINT CLIENTE_ID_CLIENTE_PK PRIMARY KEY,
    NOMBRE_USUARIO VARCHAR(30)
    CONSTRAINT CLIENTE_NOMBRE_USUARIO_NN NOT NULL
    CONSTRAINT CLIENTE_NOMBRE_USUARIO_UK UNIQUE,
    METODO_PAGO NUMBER(16)
    CONSTRAINT CLIENTE_METODO_PAGO_UK UNIQUE
    CONSTRAINT CLIENTE_METODO_PAGO_NN NOT NULL,
    CONTRASENIA VARCHAR(20)
    CONSTRAINT CLIENTE_CONTRASENIA_NN NOT NULL,
    NOMBRE VARCHAR2(50)
    CONSTRAINT CLIENTE_NOMBRE_NN NOT NULL,
    APELLIDO_PATERNO VARCHAR2(50)
    CONSTRAINT CLIENTE_APELLIDO_PATERNO_NN NOT NULL,
    APELLIDO_MATERNO VARCHAR2(50)
    CONSTRAINT CLIENTE_APELLIDO_MATERNO_NN NOT NULL,
    CORREO VARCHAR2(50)
    CONSTRAINT CIENTE_CORREO_UK UNIQUE
    CONSTRAINT CLIENTE_CORREO_NN NOT NULL,
    TELEFONO NUMBER(10)
    CONSTRAINT CLIENTE_TELEFONO_UK UNIQUE
    CONSTRAINT CLIENTE_TELEFONO_NN NOT NULL,
    ID_MEMBRESIA NUMBER(5)
    CONSTRAINT CLIENTE_MEMBRESIA_FK REFERENCES MEMBRESIA(ID_MEMBRESIA)
);

CREATE TABLE MEMBRESIA(
    ID_MEMBRESIA NUMBER(5)
    CONSTRAINT MEMBRESIA_ID_MEMBRESIA_PK PRIMARY KEY,
    TIPO VARCHAR2(50)
    CONSTRAINT MEMBRESIA_TIPO_NN NOT NULL
    CONSTRAINT MEMBRESIA_TIPO_CHK CHECK(TIPO IN ('NORMAL','PLATINO','DIAMANTE'))
);

CREATE TABLE COMPRA(
    ID_COMPRA NUMBER(5)
    CONSTRAINT COMPRA_ID_COMPRA_PK PRIMARY KEY,
    TOTAL NUMBER(5)
    CONSTRAINT COMPRA_TOTAL_NN NOT NULL
    CONSTRAINT COMPRA_TOTAL_CHK CHECK(TOTAL>0),
    FECHA DATE
    CONSTRAINT COMPRA_FECHA_NN NOT NULL
);

CREATE TABLE CLIENTE_COMPRA(
    ID_CLIENTE NUMBER(5)
    CONSTRAINT CLIENTE_COMPRA_ID_CLIENTE_FK REFERENCES CLIENTE(ID_CLIENTE),
    ID_COMPRA NUMBER(5)
    CONSTRAINT CLIENTE_COMPRA_ID_COMPRA_FK REFERENCES COMPRA(ID_COMPRA)
    CONSTRAINT CLIENTE_COMPRA_ID_COMPRA_NN NOT NULL
);

CREATE TABLE ASIENTO(
    ID_ASIENTO CHAR(3)
    CONSTRAINT ASIENTO_ID_ASIENTO_PK PRIMARY KEY,
    FILA NUMBER(2)
    CONSTRAINT ASIENTO_FILA_NN NOT NULL
    CONSTRAINT ASIENTO_FILA_CHK CHECK(FILA>0),
    COLUMNA CHAR(1)
    CONSTRAINT ASINETO_COLUMNA_NN NOT NULL
);

CREATE TABLE TIPO_BOLETO(
    ID_TIPO NUMBER(1)
    CONSTRAINT TIPO_BOLETO_ID_TIPO PRIMARY KEY,
    PRECIO NUMBER(3,2)
    CONSTRAINT TIPO_BOLETO_PRECIO_NN NOT NULL
    CONSTRAINT TIPO_BOLERO_PRECIO_CHK CHECK(PRECIO>0)
);

CREATE TABLE SUCURSAL(
    ID_SUCURSAL NUMBER(5)
    CONSTRAINT SUCURSAL_ID_SUCURSAL_PK PRIMARY KEY,
    CIUDAD VARCHAR2(50)
    CONSTRAINT SUCURSAL_CIUDAD_NN NOT NULL
);

CREATE TABLE SALA(
    ID_SALA NUMBER(5)
    CONSTRAINT SALA_ID_SALA_PK PRIMARY KEY,
    TIPO VARCHAR2(50)
    CONSTRAINT SALA_TIPO_NN NOT NULL
    CONSTRAINT SALA_TIPO_CHK CHECK(TIPO IN ('NORMAL','VIP')),
    ID_SUCURSAL NUMBER(5)
    CONSTRAINT SALA_ID_SUCURSAL_FK REFERENCES SUCURSAL(ID_SUCURSAL)
    CONSTRAINT SALA_ID_SUCURSAL_NN NOT NULL
);

CREATE TABLE PELICULA(
    ID_PELICULA NUMBER(5)
    CONSTRAINT PELICULA_ID_PELICULA_PK PRIMARY KEY,
    NOMBRE VARCHAR2(50)
    CONSTRAINT PELICULA_NOMBRE_NN NOT NULL,
    RESUMEN VARCHAR2(500)
    CONSTRAINT PELICULA_RESUMEN_NN NOT NULL,
    CLASIFICACION CHAR(3)
    CONSTRAINT PELICULA_CLASIFICACION_NN NOT NULL,
    TRAILER BLOB
    CONSTRAINT PELICULA_TRAILER_NN NOT NULL,
    DURACION NUMBER(3)
    CONSTRAINT PELICULA_DURACION_NN NOT NULL
    CONSTRAINT PELICULA_DURACION_CHK CHECK(DURACION>0),
    POSTER BLOB
    CONSTRAINT PELICULA_POSTER_NN NOT NULL,
    GENERO VARCHAR2(50)
    CONSTRAINT PELICULA_GENERO_NN NOT NULL
);

CREATE TABLE FUNCION(
    ID_FUNCION NUMBER(5)
    CONSTRAINT FUNCION_ID_FUNCION_PK PRIMARY KEY,
    FECHA DATE DEFAULT SYSDATE
    CONSTRAINT FUNCION_FECHA_NN NOT NULL,
    HORA VARCHAR2(5)
    CONSTRAINT FUNCION_HORA_NN NOT NULL,
    ASIENTOS_DISPONIBLES NUMBER(3)
    CONSTRAINT FUNCION_ASIENTOS_DISPONIBLES_NN NOT NULL
    CONSTRAINT FUNCION_ASIENTOS_DISPONIBLES_CHK CHECK(ASIENTOS_DISPONIBLES IN (30,200)),
    ID_SUCURSAL NUMBER(5)
    CONSTRAINT FUNCION_ID_SUCURSAL_FK REFERENCES SUCURSAL(ID_SUCURSAL)
    CONSTRAINT FUNCION_ID_SUCURSAL_NN NOT NULL,
    ID_PELICULA NUMBER(5)
    CONSTRAINT FUNCION_ID_PELICULA_FK REFERENCES PELICULA(ID_PELICULA)
    CONSTRAINT FUNCION_ID_PELICULA_NN NOT NULL,
    ID_SALA NUMBER(5)
    CONSTRAINT FUNCION_ID_SALA_FK REFERENCES SALA(ID_SALA)
    CONSTRAINT FUNCION_ID_SALA_NN NOT NULL
);

CREATE TABLE FUNCION_ASIENTO(
    ID_FUNCION NUMBER(5)
    CONSTRAINT FUNCION_ASIENTO_ID_FUNCION_FK REFERENCES FUNCION(ID_FUNCION)
    CONSTRAINT FUNCION_ASIENTO_ID_FUNCION_NN NOT NULL,
    ID_ASIENTO CHAR(3)
    CONSTRAINT FUNCION_ID_ASIENTO_FK REFERENCES ASIENTO(ID_ASIENTO)
    CONSTRAINT FUNCION_ID_ASIENTO_NN NOT NULL
);

CREATE TABLE BOLETO(
    ID_BOLETO NUMBER(5)
    CONSTRAINT BOLETO_ID_BOLETO_PK PRIMARY KEY,
    DESCUENTO NUMBER(1)
    CONSTRAINT BOLETO_DESCUENTO_NN NOT NULL,
    CONSTRAINT BOLETO_DESCUENTO_CHK CHECK(DESCUENTO IN (0,1)),
    ID_SUCURSAL NUMBER(5)
    CONSTRAINT BOLETO_ID_SUCURSAL_FK REFERENCES SUCURSAL(ID_SUCURSAL)
    CONSTRAINT BOLETO_ID_SUCURSAL_NN NOT NULL,
    ID_PELICULA NUMBER(5)
    CONSTRAINT BOLETO_ID_PELICULA_FK REFERENCES PELICULA(ID_PELICULA)
    CONSTRAINT BOLETO_ID_SPELICULA_NN NOT NULL,
    ID_SALA NUMBER(5)
    CONSTRAINT BOLETO_ID_SALA_FK REFERENCES SALA(ID_SALA)
    CONSTRAINT BOLETO_ID_SALA_NN NOT NULL,
    ID_ASIENTO CHAR(3)
    CONSTRAINT BOLETO_ID_ASIENTO_FK REFERENCES ASIENTO(ID_ASIENTO)
    CONSTRAINT BOLETO_ID_ASIENTO_NN NOT NULL,
    ID_COMPRA NUMBER(5)
    CONSTRAINT BOLETO_ID_COMPRA_FN REFERENCES COMPRA(ID_COMPRA)
    CONSTRAINT BOLETO_ID_COMPRA_NN NOT NULL,
    ID_FUNCION NUMBER(5)
    CONSTRAINT BOLETO_ID_FUNCION_FK REFERENCES FUNCION(ID_FUNCION)
    CONSTRAINT BOLETO_ID_FUNCION_NN NOT NULL,
    ID_TIPO_BOLETO NUMBER(1)
    CONSTRAINT BOLETO_ID_TIPO_BOLETO_FK REFERENCES TIPO_BOLETO(ID_TIPO)
    CONSTRAINT BOLETO_ID_TIPO_BOLETO_NN NOT NULL
);

DROP TABLE CLIENTE CASCADE CONSTRAINTS;
DROP TABLE MEMBRESIA CASCADE CONSTRAINTS;
DROP TABLE COMPRA;
DROP TABLE CLIENTE_COMPRA;